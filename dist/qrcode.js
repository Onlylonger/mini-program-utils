'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _qrcode=require('./libs/qrcode');var utf16to8=function utf16to8(str){var out='';var len=str.length;for(var i=0;i<len;i++){var c=str.charCodeAt(i);if(c>=1&&c<=127){out+=str.charAt(i)}else if(c>2047){out+=String.fromCharCode(224|c>>12&15);out+=String.fromCharCode(128|c>>6&63);out+=String.fromCharCode(128|c>>0&63)}else{out+=String.fromCharCode(192|c>>6&31);out+=String.fromCharCode(128|c>>0&63)}}return out};function drawQrcode(options){options=options||{};options=Object.assign({sx:0,sy:0,reserve:false,width:256,height:256,typeNumber:-1,correctLevel:_qrcode.QRErrorCorrectLevel.H,background:'#ffffff',foreground:'#000000'},options);if(!options.canvasId){console.warn('please you set canvasId!');return}createCanvas();function createCanvas(){var qrcode=new _qrcode.QRCode(options.typeNumber,options.correctLevel);qrcode.addData(utf16to8(options.text));qrcode.make();var ctx=options._this?wx.createCanvasContext&&wx.createCanvasContext(options.canvasId,options._this):wx.createCanvasContext&&wx.createCanvasContext(options.canvasId);var tileW=options.width/qrcode.getModuleCount();var tileH=options.height/qrcode.getModuleCount();for(var row=0;row<qrcode.getModuleCount();row++){for(var col=0;col<qrcode.getModuleCount();col++){var style=qrcode.isDark(row,col)?options.foreground:options.background;ctx.setFillStyle(style);var w=Math.ceil((col+1)*tileW)-Math.floor(col*tileW);var h=Math.ceil((row+1)*tileW)-Math.floor(row*tileW);ctx.fillRect(Math.round(options.sx+col*tileW),Math.round(options.sy+row*tileH),w,h)}}ctx.draw(options.reserve,function(e){options.callback&&options.callback(e)})}}exports.default=drawQrcode;